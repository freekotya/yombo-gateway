{% extends "lib/webinterface/fragments/layout.tpl" %}
{% import "lib/webinterface/fragments/macros.tpl" as macros%}

{% block content %}
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header"><a class="success" href="/devices/index" aria-label="Delete">
  </a> Device Information<br>
 {% if device.status == 0 %}
                    <a class="btn btn-md btn-primary" href="/devices/{{device.device_id}}/edit">Edit Device</a>
                    <a class="btn btn-md btn-success" href="/devices/{{device.device_id}}/enable">Enable Device</a>
                    <a class="btn btn-md btn-danger" href="/devices/{{device.device_id}}/delete">Delete Device</a>
 {% elif device.status == 1  %}
                    <a class="btn btn-md btn-primary" href="/devices/{{device.device_id}}/edit">Edit Device</a>
                    <a class="btn btn-md btn-warning" href="/devices/{{device.device_id}}/disable">Disable Device</a>
                    <a class="btn btn-md btn-danger" href="/devices/{{device.device_id}}/delete">Delete Device</a>
 {% elif device.status == 2  %}
                    <a class="btn btn-md btn-danger" href="/devices/{{device.device_id}}/enable">Enable Device</a>
 {% endif %}
                        </h1>
                    <p></p>
                </div>
                <!-- /.col-lg-12 -->
            </div>
 {% if device.status == 0 %}
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default panel-red">
                        <div class="panel-heading">
                            <label>Device Disabled</label>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <label style="margin-top: 0px; margin-bottom: 0px">This device has been disabled and is not accessible to the
                            system for automation purposes.</label>
                        </div>
                    </div>
                </div>
                <!-- /.col-lg-12 -->
            </div>
 {% elif device.status == 2  %}
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default panel-red">
                        <div class="panel-heading">
                            <label>Device Deleted</label>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <label style="margin-top: 0px; margin-bottom: 0px">This device has been deleted and is not accessible to the
                            system for automation purposes.</label>
                        </div>
                    </div>
                </div>
                <!-- /.col-lg-12 -->
            </div>
 {% endif %}
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    {{ macros.modal("cmdresultmodal", 'Command Results', '
                    <p><div id="cmdresult"></div></p>') }}
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <label>Available Commands</label> (Click to send command)
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            {% for command in device.available_commands() %}
                            <label style="margin-top: 0px; margin-bottom: 0px">
                                <a class="deviceCmd" data-doc_value="{{ commands[command].cmdUUID }}" href="/api/v1/devices?action=runcommand&deviceid={{ device.device_id }}&commandid={{ commands[command].command_id }}">{{ commands[command].label }}</a>
                            </label>&nbsp;&nbsp;
                            {% endfor %}
                        </div>
                    </div>
                    <!-- /.panel-body -->
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6 col-md-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <label>Basic Information</label>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <label style="margin-top: 0px; margin-bottom: 0px">Label: </label><br>
                            {{ device.label }}<br>

                            <label style="margin-top: 15px; margin-bottom: 0px">Description: </label><br>
                            {{ device.description }}<br>
                            <label style="margin-top: 15px; margin-bottom: 0px">Status: </label><br>
                            {{ device.status|status_to_string }}<br>
                            <label style="margin-top: 15px; margin-bottom: 0px">Pin Required // Pin Code: </label><br>
                            {{ device.pin_required|yes_no }} // {{ device.pin_code }} <br>
                            <label style="margin-top: 15px; margin-bottom: 0px">Device Type: </label><br>
                            <a href="/devtools/config/device_types/{{ device.device_type_id }}/details">{{ device_types.get(device.device_type_id).label }}</a><br>
                            <label style="margin-top: 15px; margin-bottom: 0px">Statistic Label: </label><br>
                            {{ device.statistic_label }}<br>
                            <label style="margin-top: 15px; margin-bottom: 0px">Statistic Lifetime: </label><br>
                            {{ device.statistic_lifetime }}<br>
                            <label style="margin-top: 15px; margin-bottom: 0px">Energy Type: </label><br>
                            {{ device.energy_type }}<br>
                            <label style="margin-top: 15px; margin-bottom: 0px">Energy Map: </label><br>
                            {% if device.energy_map is none -%}
                            None
                            {% else -%}
                            <table width="100%" class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th>%</th><th>Energy Usage</th>
                                    </tr>
                                </thead>
                                <tbody>{% for start_value, energy_usage in device.energy_map.iteritems() %}
                                     <tr>
                                        <td>{{ start_value*100 }}%</td>
                                        <td>{{ energy_usage }}</td>
                            </label>&nbsp;&nbsp;</td>
                                     </tr>{% endfor %}
                                </tbody>
                            </table>
                            {% endif %}
                        </div>
                    </div>
                    <!-- /.panel-body -->
                </div>
                <div class="col-lg-6 col-md-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <label>Current State</label>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <label style="margin-top: 0px; margin-bottom: 0px">Human: </label><br>
                            {{ device.status_history[0].human_status }}<br>
                            <label style="margin-top: 15px; margin-bottom: 0px">Current Energy Usage: </label><br>
                            {{ device.status_history[0].energy_usage }} {% if device.energy_type == 'electric' %} watts {% endif %}<br>
                            <label style="margin-top: 15px; margin-bottom: 0px">Machine: </label><br>
                            {{ device.status_history[0].machine_status }}<br>
                            <label style="margin-top: 15px; margin-bottom: 0px">Extra: </label><br>
                            {{ device.status_history[0].machine_status_extra }}<br>
                        </div>
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.col-lg-6 -->
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4>Device Variables</h4>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                           {% if device_variables|length != 0 -%}
                           <div class="dataTable_wrapper">
                                <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-variables">
                                    <thead>
                                        <tr>
                                            <th>Field Label</th><th>Values</th>
                                        </tr>
                                    </thead>
                                    <tbody>{% for field_label, variable in device_variables.iteritems() %}
                                         <tr>
                                            <td> {{ variable.field_label }}</td>
                                            <td><table class="table table-striped table-bordered table-hover">
                                                <tbody>{% for data_id, data in variable.data.iteritems() %}
                                                <tr>
                                                    <td>{{ data.value }}</td>
                                                </tr>
                                                {%- endfor %}
                                                </tbody>

                                            </table></td>
                                         </tr>{% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% else %}
                            <h4>No Variables</h4>
                        {% endif %}
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.col-lg-6 -->
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4>Device History</h4>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                           <div class="dataTable_wrapper">
                                <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-history">
                                    <thead>
                                        <tr>
                                            <th>Time</th><th>Reqeusted By</th><th>Reporting Source</th><th>Human</th><th>Energy Usage</th><th>Machine</th><th>Extra</th>
                                        </tr>
                                    </thead>
                                    <tbody>{% for history in device.status_history %}
                                         <tr>
                                            <td> {{ history.set_time|epoch_to_human }}</td>
                                            <td> {{ history.requested_by.component }}:{{ history.requested_by.user_id }}</td>
                                            <td> {{ history.source }}</td>
                                            <td> {{ history.human_status }}</td>
                                            <td> {{ history.energy_usage }}</td>
                                            <td> {{ history.machine_status }}</td>
                                            <td> {{ history.machine_status_extra }}</td>
                                         </tr>{% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.col-lg-6 -->
            </div>
            <!-- /.row -->
            <!-- /.row -->
{% endblock %}

{% block body_bottom %}
    <!-- Make the tables pretty -->
    <script>
$('.deviceCmd').click(function (event){
     event.preventDefault();
     $.ajax({
        url: $(this).attr('href'),
        dataType: 'json',
        success: function(resp){
            $("#cmdresult").html(resp.message);
            $("#cmdresultmodal").modal('show');
            setTimeout(function() {$('#cmdresultmodal').modal('hide');}, 2000);        }
     })
     return false; //for good measure
});

    </script>
{% endblock %}
