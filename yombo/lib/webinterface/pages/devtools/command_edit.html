{% extends "lib/webinterface/fragments/layout.tpl" %}
{% import "lib/webinterface/fragments/macros.tpl" as macros%}

{% block content %}
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header"><a class="success" href="/devices/index" aria-label="Delete">
  <i class="fa fa-arrow-left" aria-hidden="true"></i>
</a> Command Configuration</h1>
                    <p></p>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <form method="post" id="commandedit">
            <div class="row">
                <div class="col-lg-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <label>Basic Information</label>
                            </div>
                            <!-- /.panel-heading -->
                            <div class="panel-body">
                                <label style="margin-top: 0px; margin-bottom: 0px">Label: </label><br>
                                <div class="input-group">
                                    <input type="text" class="form-control" name="label" id="label" size="15" placeholder="'Bedroom light', 'Living room fan'" value="{{ command.label }}" autofocus required>
                                </div>
                                <label style="margin-top: 20px; margin-bottom: 0px">Machine Label: </label>
                                <a href="#" data-toggle="modal" data-target="#modalmachinelabel"><i class="fa fa-question fa-lg"></i></a>
                                {{ macros.modal("modalmachinelabel", 'Command enabled / disabled', '
                                The machine label is used by developers and the gateway to determine uniqueness. Once set, this cannot be changed!') }}
                                <br>
                                <div class="input-group">
                                    <input type="text" class="form-control" name="machine_label" id="machine_label" size="15" placeholder="on, off, open, close..." value="{{ command.machine_label }}">
                                </div>
                                <label style="margin-top: 20px; margin-bottom: 0px">Voice Command: </label>
                                <a href="#" data-toggle="modal" data-target="#modalvoicecommand"><i class="fa fa-question fa-lg"></i></a>
                                {{ macros.modal("modalvoicecommand", 'Command enabled / disabled', '
                                The voice command value is what is matched during a voice command search. This typically is the same as label or machine label without any punctuation other than spaces.') }}
                                <br>
                                <div class="input-group">
                                    <input type="text" class="form-control" name="voice_cmd" id="voice_cmd" size="15" placeholder="on, off, open, close..." value="{{ command.voice_cmd }}">
                                </div>
                                <label style="margin-top: 20px; margin-bottom: 0px">Description: </label><br>
                                <div class="input-group">
                                    <input type="text" class="form-control" name="description" id="description" size="30" placeholder="Description of command." value="{{ command.description }}">
                                </div>
                                <label style="margin-top: 20px; margin-bottom: 0px">Status: </label>
                                <a href="#" data-toggle="modal" data-target="#modalstatus"><i class="fa fa-question fa-lg"></i></a>
                                {{ macros.modal("modalstatus", 'Command enabled / disabled', '
                                <p>You can enable or disable the command as needed. When disabled, the command cannot be sent to devices.</p>
                                <p>Items will be marked deleted a while before they are actually purged from the system. This allows the
                                delete command to fully propogate through the entire Yombo eco system.</p>') }}
                                <br>
                                <div class="input-group">
                                    <select class="form-control" name="status" id="status">
                                        <option value="0"{% if command.status == 0 %} selected{% endif %}>Disabled</option>
                                        <option value="1"{% if command.status == 1 %} selected{% endif %}>Enabled</option>
                                        <option value="2"{% if command.status == 2 %} selected{% endif %}>Deleted</option>
                                    </select>
                                </div>
                                <label style="margin-top: 20px; margin-bottom: 0px">Public Status: </label>
                                <a href="#" data-toggle="modal" data-target="#modalpublicstatus"><i class="fa fa-question fa-lg"></i></a>
                                {{ macros.modal("modalpublicstatus", 'Command public status', '
                                <p>There are three public status levels:</p>
                                <ul>
                                    <li>private - Only the user that created the command can manage or use the command.</li>
                                    <li>public pending - Access like private, but a request is pending with Yombo support to convert it to public.</li>
                                    <li>public - Available to any Yombo user. Once it\'s public, it\'s can no longer be controlled by the creator.</li>
                                </ul>
                                <p>Items will be marked deleted a while before they are actually purged from the system. This allows the
                                delete command to fully propogate through the entire Yombo eco system.</p>') }}
                                <br>
                                <div class="input-group">
                                    <select class="form-control" name="public" id="public">
                                        <option value="0"{% if command.public == 0 %} selected{% endif %}>Private</option>
                                        <option value="1"{% if command.public == 1 %} selected{% endif %}>Public Pending</option>
                                        <option value="2"{% if command.public == 2 %} selected{% endif %}>Public</option>
                                    </select>
                                </div>
                                <label style="margin-top: 20px; margin-bottom: 0px">Input Type: </label>
                                <a href="#" data-toggle="modal" data-target="#modalinputtype"><i class="fa fa-question fa-lg"></i></a>
                                {{ macros.modal("modalinputtype", 'Command input type', '
                                <p>Some commands expect certain configurations. An input type defines pre-determined settings.</p>
                                ') }}
                                <br>
                                <div class="input-group">
                                    <select class="form-control" name="input_type" id="input_type">
                                        {% for inputID, input_type in input_types.iteritems() -%}
                                        <option value="{{ inputID }}"{% if command.input_type_id == inputID %} selected{% endif %}>{{ input_type.label }}</option>
                                        {% endfor -%}
                                    </select>
                                </div>

                            </div>
                        </div>
                        <!-- /.panel-body -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <input type="submit" />
            </form>
{% endblock %}

{% block body_bottom %}
    <!-- Make the tables pretty -->
    <script>
     $(document).ready(function(){
        var i=1;
        $("#add_row").click(function(){
            $('#energymap tr:last').after('<tr>\
                                            <td><input type="text" class="form-control" name="start_percent" id="start_percent" value=""></td>\
                                            <td><input type="text" class="form-control" name="energy_usage" id="energy_usage" value=""></td>\
                                            <td><a href="#">Delete</a></td>\
                                         </tr>');
            i++;
        });
        $(".deleterow").click(function(event) {
            var href = $(this).attr('href');
            $(this).closest("tr").remove(); // remove row
            return false; // prevents default behavior
        });

        (function($) {
            $.extend({
                toDictionary: function(query) {
                    var parms = {};
                    var items = query.split("&"); // split
                    for (var i = 0; i < items.length; i++) {
                        var values = items[i].split("=");
                        var key = decodeURIComponent(values.shift());
                        var value = values.join("=")
                        parms[key] = decodeURIComponent(value);
                    }
                    return (parms);
                }
            })
        })(jQuery);

        (function($) {
            $.fn.serializeFormJSON = function() {
                var o = [];
                $(this).find('tr').each(function() {
                    var elements = $(this).find('input, textarea, select')
                    if (elements.size() > 0) {
                        var serialized = $(this).find('input, textarea, select').serialize();
                        var item = $.toDictionary(serialized );
                        o.push(item);
                    }
                });
                return o;
            };
        })(jQuery);

        $("#deviceedit").submit(function(event) {
//            event.preventDefault();

            var rawData = $('#deviceedit').serializeFormJSON();
            var formData = JSON.stringify(rawData);
            console.log(formData);
        });


    });

    $('.ls-modal').on('click', function(e){
      e.preventDefault();
      $('#myModal').modal('show').find('.modal-body').load($(this).attr('href'));
    });


    </script>
{% endblock %}
